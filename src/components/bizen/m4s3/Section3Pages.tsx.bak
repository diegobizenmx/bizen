/* eslint-disable @next/next/no-img-element */
"use client"

import * as React from "react"
import { useMemo } from "react"
import { motion, Variants } from "framer-motion"

type LayoutOption = "A" | "B"

type Page1Props = {
  brandName?: string
  logoSrc?: string
  primaryColor?: string
  background?: string
  progressPercent?: number
  title?: string
  topicTitle?: string
  introText?: string
  keyIdea?: string
  whyTitle?: string
  whyBody?: string
  whyExampleTitle?: string
  whyExampleText?: string
  glossaryTitle?: string
  glossaryItems?: string[]
  stepsTitle?: string
  stepsItems?: string[]
  errorsTitle?: string
  errorsItems?: string[]
  qaTitle?: string
  qaItems?: string[]
  heroImage?: string
  layoutOption?: LayoutOption
  baseFontSize?: number
}

const MAX_WIDTH = 1200

const containerVar: Variants = {
  hidden: { opacity: 0, y: 16 },
  show: { opacity: 1, y: 0, transition: { staggerChildren: 0.06, ease: "easeOut" } },
}

const itemVar: Variants = {
  hidden: { opacity: 0, y: 10 },
  show: { opacity: 1, y: 0, transition: { ease: "easeOut" } },
}

function Card({
  children,
  glow,
  borderColor = "rgba(0,0,0,0.08)",
}: {
  children: React.ReactNode
  glow?: string
  borderColor?: string
}) {
  return (
    <div
      style={{
        position: "relative" as const,
        borderRadius: 16,
        padding: 20,
        border: `1px solid ${borderColor}`,
        background: "linear-gradient(180deg, #fff, #ffffffcc)",
        backdropFilter: "blur(6px)",
        boxShadow: "0 10px 30px rgba(0,0,0,0.06)",
        overflow: "hidden" as const,
      }}
    >
      {glow ? (
        <div
          style={{
            position: "absolute" as const,
            inset: -120,
            pointerEvents: "none",
            background: `radial-gradient(600px 300px at 20% 0%, ${glow}22, transparent 60%)`,
          }}
        />
      ) : null}
      {children}
    </div>
  )
}

type QuizQuestion = {
  prompt: string
  options: string[]
  correctIndex?: number
}

type QuizResultPayload = {
  score: number
  total: number
  answers: number[]
}

type QuizProps = {
  brandName: string
  logoSrc: string
  primaryColor: string
  background: string
  title: string
  topicTitle: string
  heroImage: string
  layoutOption: LayoutOption
  baseFontSize: number
  questions: QuizQuestion[]
  onFinish?: (payload: QuizResultPayload) => void
}

type OptionCardProps = {
  text: string
  onClick: () => void
  selected: boolean | null
  correct: boolean | null
  primaryColor: string
  fs: number
}

const DEFAULT_QUIZ_PROPS: QuizProps = {
  brandName: "BIZEN",
  logoSrc: "",
  primaryColor: "#0F62FE",
  background: "linear-gradient(180deg, #FFFFFF, #F8FAFF)",
  title: "Sección 3",
  topicTitle: "Quiz: CTA breve, iteración y tendencias (3–30–3)",
  heroImage: "",
  layoutOption: "B",
  baseFontSize: 18,
  questions: [
    {
      prompt: "¿Cuál es el enfoque de una CTA efectiva al final de un video corto?",
      options: [
        "Incluir tres párrafos explicativos",
        "Ser breve y conectar con el beneficio",
        "Usar jerga técnica para sonar experto",
        "Evitar mencionarla para no sonar comercial",
      ],
      correctIndex: 1,
    },
    {
      prompt: "Para mejorar retención, ¿qué conviene probar durante los primeros 3–5 segundos?",
      options: [
        "Variar el gancho (copy/visual/ritmo) y medir resultados",
        "Aumentar la duración a más de 5 minutos",
        "Agregar un logo animado de 10 segundos",
        "No cambiar nada para mantener consistencia",
      ],
      correctIndex: 0,
    },
    {
      prompt: "El marco 3–30–3 sugiere:",
      options: [
        "3 ideas principales, 30 minutos por video, 3 CTAs",
        "0–3 s de gancho, ~30 s de valor, 3 palabras de CTA",
        "3 revisiones, 30 iteraciones, 3 equipos",
        "3 cámaras, 30 fps, 3 luces",
      ],
      correctIndex: 1,
    },
  ],
}

function OptionCard({ text, onClick, selected, correct, primaryColor, fs }: OptionCardProps) {
  const hasSelection = selected != null
  const bg = hasSelection ? (correct ? `${primaryColor}16` : `#ff000016`) : "#fff"
  const border = hasSelection ? (correct ? `${primaryColor}66` : `#ff000066`) : `${primaryColor}33`

  return (
    <motion.div
      role="button"
      tabIndex={0}
      onClick={onClick}
      onKeyDown={event => (event.key === "Enter" || event.key === " ") && onClick()}
      whileHover={{ scale: 0.98 }}
      whileTap={{ scale: 0.98 }}
      transition={{ type: "spring", stiffness: 280, damping: 20 }}
      style={{
        userSelect: "none",
        cursor: "pointer",
        borderRadius: 14,
        border: `1px solid ${border}`,
        background: bg,
        padding: 14,
        minHeight: 64,
        display: "flex",
        alignItems: "center",
        lineHeight: 1.4,
        fontSize: fs,
      }}
    >
      {text}
    </motion.div>
  )
}

function BIZENSection1Quiz(props: Partial<QuizProps>) {
  const {
    brandName,
    logoSrc,
    primaryColor,
    background,
    title,
    topicTitle,
    heroImage,
    layoutOption,
    baseFontSize,
    questions,
    onFinish,
  } = { ...DEFAULT_QUIZ_PROPS, ...props }

  const fs = Math.max(12, baseFontSize || 18)
  const isLeft = layoutOption === "A"
  const total = Math.max(1, questions.length)

  const wrapper = useMemo(
    () => ({
      width: "100%",
      minHeight: "100vh",
      display: "flex" as const,
      justifyContent: isLeft ? "flex-start" : "center",
      background,
      color: "#111",
      fontFamily:
        "Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji",
      fontSize: fs,
    }),
    [background, isLeft, fs]
  )

  const container = useMemo(
    () => ({
      width: "100%",
      padding: "clamp(16px, 3vw, 32px)",
      boxSizing: "border-box" as const,
      margin: isLeft ? "0" : "0 auto",
      maxWidth: isLeft ? "none" : 1200,
    }),
    [isLeft]
  )

  const [index, setIndex] = React.useState(0)
  const [answers, setAnswers] = React.useState<number[]>([])
  const [lock, setLock] = React.useState(false)

  const pct = Math.round((index / total) * 100)
  const isDone = index >= total
  const currentIndex = Math.min(index, total - 1)
  const currentQuestion = questions[currentIndex]
  const selectedAnswer = answers[currentIndex]
  const hasSelection = selectedAnswer != null
  const hasHero = Boolean(heroImage)

  const score = React.useMemo(() => {
    if (!isDone) return 0
    return questions.reduce((acc, question, questionIndex) => {
      const correctIdx = typeof question.correctIndex === "number" ? question.correctIndex : undefined
      return acc + (correctIdx != null && answers[questionIndex] === correctIdx ? 1 : 0)
    }, 0)
  }, [answers, isDone, questions])

  const handleSelect = (optionIndex: number) => {
    if (lock || isDone) return

    const nextAnswers = [...answers]
    nextAnswers[index] = optionIndex
    setAnswers(nextAnswers)
    setLock(true)

    window.setTimeout(() => {
      setLock(false)
      setIndex(prev => {
        const nextIndex = prev + 1
        if (nextIndex >= total) {
          const finalScore = questions.reduce((acc, question, questionIndex) => {
            const correctIdx = typeof question.correctIndex === "number" ? question.correctIndex : undefined
            return acc + (correctIdx != null && nextAnswers[questionIndex] === correctIdx ? 1 : 0)
          }, 0)
          onFinish?.({ score: finalScore, total, answers: nextAnswers })
        }
        return Math.min(total, nextIndex)
      })
    }, 220)
  }

  return (
    <div style={wrapper}>
      <main
        style={{
          width: "100%",
          display: "flex",
          flexDirection: "column",
          flex: 1,
          minHeight: "100vh",
        }}
      >
        <header style={{ ...container, paddingTop: 12, paddingBottom: 8 }}>
          <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
            {logoSrc ? (
              <img src={logoSrc} alt={`${brandName} logo`} style={{ height: 44, width: "auto", display: "block" }} />
            ) : (
              <div
                aria-hidden
                style={{
                  width: 28,
                  height: 28,
                  borderRadius: 8,
                  background: primaryColor,
                }}
              />
            )}
            <strong style={{ letterSpacing: 0.2 }}>{brandName}</strong>
          </div>
        </header>

        <div style={{ ...container, paddingTop: 0 }}>
          <div
            style={{
              display: "flex",
              alignItems: "center",
              gap: 12,
              marginBottom: 14,
            }}
          >
            <motion.span
              initial={{ scale: 1 }}
              animate={{ scale: [1, 1.15, 1] }}
              transition={{ duration: 1.2, repeat: Infinity, ease: "easeInOut" }}
              style={{
                display: "inline-flex",
                alignItems: "center",
                gap: 8,
                padding: "8px 12px",
                borderRadius: 999,
                background: `${primaryColor}14`,
                color: primaryColor,
                fontWeight: 700,
                fontSize: fs * 0.95,
                minWidth: 56,
                justifyContent: "center",
              }}
              aria-label="porcentaje de avance"
            >
              {Math.min(100, pct)}%
            </motion.span>

            <div
              style={{
                flex: 1,
                height: 10,
                background: "rgba(0,0,0,0.08)",
                borderRadius: 999,
                overflow: "hidden",
              }}
            >
              <motion.div
                initial={{ scaleY: 1 }}
                animate={{ scaleY: [1, 1.06, 1] }}
                transition={{ duration: 1.2, repeat: Infinity, ease: "easeInOut" }}
                style={{
                  width: `${Math.min(100, pct)}%`,
                  height: "100%",
                  background: primaryColor,
                  borderRadius: 999,
                  transformOrigin: "center",
                }}
              />
            </div>
          </div>
        </div>

        <section style={{ flex: 1, display: "block" }}>
          <div style={{ ...container }}>
            <motion.div variants={containerVar} initial="hidden" animate="show">
              <motion.div variants={itemVar} style={{ marginBottom: 18 }}>
                <h1 style={{ margin: 0, fontSize: fs * 2.2, lineHeight: 1.15 }}>{title}</h1>
                <p style={{ margin: "8px 0 0", opacity: 0.9, fontSize: fs * 1.15 }}>
                  <span style={{ color: primaryColor, fontWeight: 700 }}>▌</span> {topicTitle}
                </p>
              </motion.div>

              {hasHero ? (
                <motion.div
                  variants={itemVar}
                  style={{
                    borderRadius: 16,
                    overflow: "hidden",
                    boxShadow: "0 18px 60px rgba(0,0,0,0.12)",
                    marginTop: 16,
                    marginBottom: 18,
                  }}
                >
                  <img src={heroImage} alt="Hero" style={{ width: "100%", height: "auto", display: "block" }} />
                </motion.div>
              ) : null}

              {!isDone ? (
                <motion.div variants={itemVar} style={{ marginBottom: 16 }}>
                  <Card glow={primaryColor}>
                    <div
                      style={{
                        display: "flex",
                        alignItems: "center",
                        gap: 10,
                        marginBottom: 10,
                      }}
                    >
                      <div
                        aria-hidden
                        style={{
                          width: 18,
                          height: 18,
                          borderRadius: 6,
                          background: primaryColor,
                        }}
                      />
                      <h3 style={{ margin: 0, fontSize: fs * 1.25 }}>
                        Pregunta {index + 1} de {total}
                      </h3>
                    </div>

                    <p
                      style={{
                        margin: "0 0 14px 0",
                        fontSize: fs * 1.05,
                        lineHeight: 1.5,
                      }}
                    >
                      {currentQuestion.prompt}
                    </p>

                    <div style={{ display: "grid", gap: 12 }}>
                      {currentQuestion.options.map((option, optionIndex) => {
                        const isSelected = hasSelection ? optionIndex === selectedAnswer : null
                        const isCorrect =
                          hasSelection && typeof currentQuestion.correctIndex === "number"
                            ? optionIndex === currentQuestion.correctIndex
                            : null

                        return (
                          <OptionCard
                            key={optionIndex}
                            text={option}
                            onClick={() => handleSelect(optionIndex)}
                            selected={isSelected}
                            correct={isCorrect}
                            primaryColor={primaryColor}
                            fs={fs}
                          />
                        )
                      })}
                    </div>
                  </Card>
                </motion.div>
              ) : (
                <motion.div variants={itemVar} style={{ marginBottom: 16 }}>
                  <Card glow={primaryColor}>
                    <h3 style={{ margin: 0, fontSize: fs * 1.3 }}>¡Listo! Has completado el cuestionario</h3>
                    {typeof questions[0]?.correctIndex === "number" ? (
                      <p style={{ margin: "8px 0 0", opacity: 0.9 }}>
                        Puntaje: <strong>{score}</strong> / {total}
                      </p>
                    ) : (
                      <p style={{ margin: "8px 0 0", opacity: 0.9 }}>Gracias por responder.</p>
                    )}
                    <p style={{ margin: "8px 0 0", opacity: 0.8 }}>
                      Puedes cerrar esta sección o navegar desde el menú de tu app.
                    </p>
                  </Card>
                </motion.div>
              )}
            </motion.div>
          </div>
        </section>
      </main>
    </div>
  )
}

function Page1({
  brandName = "BIZEN",
  logoSrc = "/bizen-mondragonlogo.png",
  primaryColor = "#0F62FE",
  background = "linear-gradient(180deg, #FFFFFF, #F8FAFF)",
  progressPercent = 30,
  title = "Sección 3",
  topicTitle = "Videos cortos y reels virales — gancho, mensaje y compartibilidad",
  introText = "",
  keyIdea = "En formatos cortos: gana en los primeros 3 segundos, explica una sola idea y diseña para que la gente quiera compartir.",
  whyTitle = "1) La batalla de los 3 segundos",
  whyBody = "En formatos cortos, el inicio decide todo. Usa ganchos: pregunta poderosa, dato sorpresa, promesa concreta o imagen llamativa. Evita introducciones largas.",
  whyExampleTitle = "Ganchos útiles",
  whyExampleText = "Pregunta poderosa · Dato sorpresa · Promesa concreta · Imagen llamativa.",
  glossaryTitle = "2) Una sola idea por video",
  glossaryItems = [
    "Explica o muestra una sola idea con lenguaje simple.",
    "Un ejemplo breve vale más que un concepto vago.",
    "La claridad permite que más personas lo entiendan a la primera.",
  ],
  stepsTitle = "3) ¿Por qué la gente comparte?",
  stepsItems = [
    "Emoción.",
    "Humor.",
    "Utilidad inmediata.",
    "Identificación.",
    "Diseña tu contenido para provocar al menos una de estas respuestas.",
  ],
  errorsTitle = "Errores comunes",
  errorsItems = [],
  qaTitle = "",
  qaItems = [],
  heroImage = "",
  layoutOption = "A",
  baseFontSize = 18,
}: Page1Props) {
  const fs = Math.max(12, baseFontSize || 18)
  const isA = layoutOption === "A"
  const pct = Math.max(0, Math.min(100, Math.round(progressPercent || 0)))

  const wrapper: React.CSSProperties = useMemo(
    () => ({
      width: "100%",
      display: "flex" as const,
      justifyContent: isA ? "flex-start" : "center",
      background,
      color: "#111",
      fontFamily:
        "Montserrat, Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji",
      fontSize: fs,
    }),
    [background, isA, fs]
  )

  const container: React.CSSProperties = useMemo(
    () => ({
      width: "100%",
      maxWidth: isA ? "none" : MAX_WIDTH,
      padding: "20px",
      boxSizing: "border-box" as const,
    }),
    [isA]
  )

  return (
    <div style={wrapper}>
      <main style={{ width: "100%" }}>
        <header style={{ ...container, paddingTop: 12, paddingBottom: 8 }}>
          <div style={{ display: "flex" as const, alignItems: "center" as const, gap: 12 }}>
            {logoSrc ? (
              <img src={logoSrc} alt={`${brandName} logo`} style={{ height: 62, width: "auto", display: "block" }} />
            ) : (
              <div aria-hidden style={{ width: 28, height: 28, borderRadius: 8, background: primaryColor }} />
            )}
            <strong style={{ letterSpacing: 0.2, fontWeight: 800, color: primaryColor, fontSize: fs * 1.35 }}>{brandName}</strong>
          </div>
        </header>

        <div style={{ ...container, paddingTop: 0 }}>
          <div style={{ display: "flex" as const, alignItems: "center" as const, gap: 12, marginBottom: 8 }}>
            <motion.span
              initial={{ scale: 1 }}
              animate={{ scale: [1, 1.15, 1] }}
              transition={{ duration: 1.2, repeat: Infinity, ease: "easeInOut" }}
              style={{
                display: "inline-flex" as const,
                alignItems: "center" as const,
                gap: 8,
                padding: "6px 10px",
                borderRadius: 999,
                background: `${primaryColor}14`,
                color: primaryColor,
                fontWeight: 700,
                fontSize: fs * 0.9,
              }}
              aria-label="porcentaje de avance"
            >
              {pct}%
            </motion.span>

            <div
              style={{
                flex: 1,
                height: 8,
                background: "rgba(0,0,0,0.08)",
                borderRadius: 999,
                overflow: "hidden" as const,
              }}
            >
              <div
                style={{
                  width: `${pct}%`,
                  height: "100%",
                  background: primaryColor,
                  borderRadius: 999,
                  transition: "width 220ms ease",
                }}
              />
            </div>
          </div>
        </div>

        <section>
          <div style={{ ...container }}>
            <motion.div variants={containerVar} initial="hidden" animate="show">
              <motion.div variants={itemVar} style={{ marginBottom: 12 }}>
                <h1 style={{ margin: 0, fontSize: fs * 2.2, lineHeight: 1.15 }}>{title}</h1>
                <p style={{ margin: "6px 0 0", opacity: 0.9, fontSize: fs * 1.15 }}>
                  <span style={{ color: primaryColor, fontWeight: 700 }}>▌</span> {topicTitle}
                </p>
              </motion.div>

              {heroImage ? (
                <motion.div
                  variants={itemVar}
                  style={{
                    borderRadius: 16,
                    overflow: "hidden" as const,
                    boxShadow: "0 18px 60px rgba(0,0,0,0.12)",
                    marginTop: 14,
                    marginBottom: 16,
                  }}
                >
                  <img src={heroImage} alt="Sección 3" style={{ width: "100%", height: "auto", display: "block" }} />
                </motion.div>
              ) : null}

              {introText ? (
                <motion.div variants={itemVar} style={{ marginBottom: 16 }}>
                  <Card glow={primaryColor}>
                    <p style={{ margin: 0, opacity: 0.95, fontSize: fs }}>{introText}</p>
                  </Card>
                </motion.div>
              ) : null}

              {keyIdea ? (
                <motion.div variants={itemVar} style={{ marginBottom: 16 }}>
                  <div
                    style={{
                      border: `1px solid ${primaryColor}44`,
                      background: `${primaryColor}0F`,
                      color: "#111",
                      borderRadius: 16,
                      padding: 16,
                    }}
                  >
                    <strong style={{ color: primaryColor, display: "block" as const, marginBottom: 6, fontSize: fs }}>Idea clave</strong>
                    <p style={{ margin: 0, opacity: 0.95, fontSize: fs }}>{keyIdea}</p>
                  </div>
                </motion.div>
              ) : null}

              <motion.div variants={itemVar} style={{ marginBottom: 16 }}>
                <Card glow={primaryColor}>
                  <h3 style={{ margin: "0 0 10px 0", fontSize: fs * 1.355 }}>{whyTitle}</h3>
                  <p style={{ margin: 0, opacity: 0.95, lineHeight: 1.55 }}>{whyBody}</p>
                  <div style={{ marginTop: 12 }}>
                    <strong style={{ color: primaryColor, display: "block" as const, marginBottom: 6 }}>{whyExampleTitle}</strong>
                    <p style={{ margin: 0, opacity: 0.95 }}>{whyExampleText}</p>
                  </div>
                </Card>
              </motion.div>

              <motion.div variants={itemVar} style={{ marginBottom: 16 }}>
                <Card glow={primaryColor}>
                  <h3 style={{ margin: "0 0 10px 0", fontSize: fs * 1.355 }}>{glossaryTitle}</h3>
                  <ul style={{ margin: 0, paddingLeft: 18, opacity: 0.95 }}>
                    {glossaryItems.map((t, i) => (
                      <li key={`g-${i}`} style={{ marginBottom: 6 }}>
                        {t}
                      </li>
                    ))}
                  </ul>
                </Card>
              </motion.div>

              {(stepsItems.length > 0 || errorsItems.length > 0) && (
                <motion.div variants={itemVar} style={{ marginBottom: 16 }}>
                  <Card glow={primaryColor}>
                    {stepsItems.length > 0 && (
                      <>
                        <h3 style={{ margin: "0 0 10px 0", fontSize: fs * 1.355 }}>{stepsTitle}</h3>
                        <ul style={{ margin: 0, paddingLeft: 18, opacity: 0.95 }}>
                          {stepsItems.map((t, i) => (
                            <li key={`s-${i}`} style={{ marginBottom: 6 }}>
                              {t}
                            </li>
                          ))}
                        </ul>
                      </>
                    )}

                    {errorsItems.length > 0 && (
                      <>
                        <h4 style={{ margin: "14px 0 8px 0", color: primaryColor, fontSize: fs * 1.1 }}>{errorsTitle}</h4>
                        <ul style={{ margin: 0, paddingLeft: 18, opacity: 0.95 }}>
                          {errorsItems.map((t, i) => (
                            <li key={`e-${i}`} style={{ marginBottom: 6 }}>
                              {t}
                            </li>
                          ))}
                        </ul>
                      </>
                    )}
                  </Card>
                </motion.div>
              )}

              {qaItems.length > 0 && (
                <motion.div variants={itemVar} style={{ marginBottom: 16 }}>
                  <Card glow={primaryColor}>
                    <h3 style={{ margin: "0 0 10px 0", fontSize: fs * 1.355 }}>{qaTitle}</h3>
                    <ul style={{ margin: 0, paddingLeft: 18, opacity: 0.95 }}>
                      {qaItems.map((t, i) => (
                        <li key={`qa-${i}`} style={{ marginBottom: 6 }}>
                          {t}
                        </li>
                      ))}
                    </ul>
                  </Card>
                </motion.div>
              )}
            </motion.div>
          </div>
        </section>
      </main>
    </div>
  )
}

function Page2() {
  return (
    <BIZENSection1Quiz
      brandName="BIZEN"
      logoSrc="/bizen-mondragonlogo.png"
      primaryColor="#0F62FE"
      background="linear-gradient(180deg, #FFFFFF, #F8FAFF)"
      title="Quiz · Ganchos, CTA y compartibilidad"
      topicTitle="Refuerza los fundamentos clave de la sección"
      layoutOption="B"
      baseFontSize={18}
    />
  )
}

function Placeholder({ label }: { label: string }) {
  return (
    <div style={{ padding: 40, textAlign: "center" }}>
      <h2 style={{ margin: 0 }}>{label}</h2>
      <p style={{ marginTop: 8, color: "#64748b" }}>Contenido en construcción.</p>
    </div>
  )
}

/**
 * Sección 2 · Quiz de opción múltiple (15) — React puro
 * - Sin Framer property controls ni botonera inferior ni botones de navegación
 * - Auto-check + auto-next: al hacer clic en una opción se corrige y avanza
 * - Barra superior NO sticky con % "breathing" a la izquierda de la barra
 * - Video opcional
 */

/** 15 preguntas de opción múltiple (A–D) */
const QUESTIONS: { text: string; options: string[]; correctIndex: number }[] = [
  { text: "1. En los primeros 3s debe...", options: ["A) Un efecto", "B) Captar la atención", "C) Explicar todo", "D) Poner subtítulos"], correctIndex: 1 },
  { text: "2. Un video viral se caracteriza por...", options: ["A) Muchos efectos", "B) Ser muy largo", "C) Que la gente quiera compartirlo", "D) Verse una sola vez"], correctIndex: 2 },
  { text: "3. Un gancho es...", options: ["A) Un filtro", "B) Frase/imagen que atrapa", "C) Un efecto complejo", "D) Una transición"], correctIndex: 1 },
  { text: "4. Mensaje sencillo porque...", options: ["A) Ahorra edición", "B) Se entiende rápido", "C) Permite más efectos", "D) Alarga grabación"], correctIndex: 1 },
  { text: "5. Emociones que más impulsan interacción...", options: ["A) Indiferencia", "B) Confusión", "C) Alegría o sorpresa", "D) Molestia"], correctIndex: 2 },
  { text: "6. Aprovechar tendencia sin copiar es...", options: ["A) Copiar exacto", "B) Adaptarla con tu estilo", "C) Ignorar", "D) Hacerla muy larga"], correctIndex: 1 },
  { text: "7. Retos/challenges ayudan a...", options: ["A) Aburrir", "B) Crear comunidad y viralidad", "C) Evitar compartir", "D) Alargar"], correctIndex: 1 },
  { text: "8. Sin inicio llamativo, lo más probable es...", options: ["A) Más retención", "B) Abandono rápido", "C) Viral automático", "D) Más claridad"], correctIndex: 1 },
  { text: "9. La gente comparte cuando...", options: ["A) Mensaje confuso", "B) Emoción/valor inmediato", "C) Video muy largo", "D) Subtítulos exagerados"], correctIndex: 1 },
  { text: "10. Un error que arruina potencial es...", options: ["A) Mensaje claro", "B) Inicio enérgico", "C) Ser aburrido o confuso", "D) Usar tendencias"], correctIndex: 2 },
  { text: "11. CTA significa...", options: ["A) Tipo de edición", "B) Invitación a actuar", "C) Filtro", "D) Reto"], correctIndex: 1 },
  { text: "12. Para detectar tendencias conviene...", options: ["A) Ignorar lo popular", "B) Observar contenido viral", "C) Crear sin plan", "D) Usar contenido viejo"], correctIndex: 1 },
  { text: "13. Suele atraer más en redes...", options: ["A) Largo y complejo", "B) Breve y directo", "C) Sin emoción", "D) Sin historia"], correctIndex: 1 },
  { text: "14. Para diferenciarte conviene...", options: ["A) Copiar a otros", "B) Ser original y auténtico", "C) Hacerlo muy largo", "D) Llenar de efectos"], correctIndex: 1 },
  { text: "15. La viralidad depende de...", options: ["A) Solo suerte", "B) Estrategia y creatividad", "C) Copiar tendencias", "D) Música popular"], correctIndex: 1 },
]

type SectionMCProps = {
  brandName?: string
  logoSrc?: string
  primaryColor?: string
  background?: string
  progressPercent?: number
  title?: string
  topicTitle?: string
  layoutOption?: "A" | "B"
  baseFontSize?: number
  videoSrc?: string
  videoPoster?: string
}

function SectionMC({
  brandName = "BIZEN",
  logoSrc = "/bizen-mondragonlogo.png",
  primaryColor = "#0F62FE",
  background = "linear-gradient(180deg, #FFFFFF, #F8FAFF)",
  progressPercent = 10,
  title = "Sección 2 · Quiz de opción múltiple",
  topicTitle = "Ganchos, viralidad, CTA y tendencias (15 preguntas)",
  layoutOption = "B",
  baseFontSize = 18,
  videoSrc = "",
  videoPoster = "",
}: SectionMCProps) {
  const fs = Math.max(12, baseFontSize || 18)
  const isA = layoutOption === "A"

  const wrapper = useMemo(
    () => ({
      width: "100%",
      display: "flex" as const,
      justifyContent: isA ? "flex-start" : "center",
      background,
      color: "#111",
      fontFamily:
        "Montserrat, Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji",
      fontSize: fs,
    }),
    [background, isA, fs]
  )

  const container = useMemo(
    () => ({
      width: "100%",
      padding: "clamp(16px, 3vw, 32px)",
      boxSizing: "border-box" as const,
      margin: isA ? "0" : "0 auto",
    }),
    [isA]
  )

  const pct = Math.max(0, Math.min(100, Math.round(progressPercent || 0)))

  const total = QUESTIONS.length
  const [idx, setIdx] = React.useState(0)
  const [selection, setSelection] = React.useState<(number | null)[]>(
    Array(total).fill(null)
  )
  const [checked, setChecked] = React.useState<boolean[]>(Array(total).fill(false))
  const [correct, setCorrect] = React.useState<boolean[]>(Array(total).fill(false))
  const [score, setScore] = React.useState(0)

  const q = QUESTIONS[idx]
  const quizProgressPct = Math.round(((idx + 1) / total) * 100)
  const answeredCount = checked.filter(Boolean).length
  const finished = answeredCount === total

  const optStyle = (active: boolean): React.CSSProperties => ({
    padding: "16px 18px",
    borderRadius: 14,
    border: `2px solid ${active ? primaryColor : "rgba(0,0,0,0.12)"}`,
    background: active ? `${primaryColor}14` : "#fff",
    fontWeight: 800,
    fontSize: fs * 1.05,
    letterSpacing: 0.2,
    cursor: "pointer",
    userSelect: "none",
    textAlign: "left",
    boxShadow: active ? "0 8px 24px rgba(0,0,0,0.06)" : "none",
    transformOrigin: "center",
  })

  // Auto-check + auto-next
  const handleOptionClick = (optIndex: number) => {
    if (checked[idx]) return

    const isCorrect = optIndex === q.correctIndex

    setSelection((prev) => {
      const next = [...prev]
      next[idx] = optIndex
      return next
    })
    setChecked((prev) => {
      const next = [...prev]
      next[idx] = true
      return next
    })
    setCorrect((prev) => {
      const next = [...prev]
      next[idx] = isCorrect
      return next
    })
    if (isCorrect) setScore((s) => s + 1)

    // Pequeño delay para ver el feedback y avanzar
    setTimeout(() => {
      setIdx((i) => Math.min(total - 1, i + 1))
    }, 220)
  }

  const feedback =
    checked[idx] && correct[idx] ? (
      <div style={{ color: "#0a7f35", fontWeight: 700 }}>✅ ¡Correcto!</div>
    ) : checked[idx] && !correct[idx] ? (
      <div style={{ color: "#b00020", fontWeight: 700 }}>
        ❌ Incorrecto. Respuesta: <strong>{q.options[q.correctIndex]}</strong>
      </div>
    ) : null

  return (
    <div style={wrapper}>
      <main style={{ width: "100%", display: "block" }}>
        {/* ───── Barra superior (NO sticky) con % a la IZQUIERDA de la barra ───── */}
        <div style={{ ...container, paddingTop: 10, paddingBottom: 10 }}>
          <div
            style={{
              display: "flex" as const,
              alignItems: "center" as const,
              justifyContent: "space-between" as const,
              gap: 16,
              flexWrap: "wrap",
            }}
          >
            {/* Brand */}
            <div style={{ display: "flex" as const, alignItems: "center" as const, gap: 12, minWidth: 200 }}>
              {logoSrc ? (
                <img
                  src={logoSrc}
                  alt={`${brandName} logo`}
                  style={{ height: 32, width: "auto", display: "block" }}
                />
              ) : (
                <div
                  aria-hidden
                  style={{ width: 24, height: 24, borderRadius: 8, background: primaryColor }}
                />
              )}
              <strong style={{ letterSpacing: 0.2, fontWeight: 800, color: primaryColor, fontSize: fs * 1.35 }}>{brandName}</strong>
            </div>

            {/* % breathing + barra */}
            <div
              style={{
                display: "flex" as const,
                alignItems: "center" as const,
                gap: 10,
                flex: "1 1 360px",
                minWidth: 280,
              }}
            >
              <motion.span
                initial={{ scale: 1 }}
                animate={{ scale: [1, 1.12, 1] }}
                transition={{ duration: 1.2, repeat: Infinity, ease: "easeInOut" }}
                style={{
                  display: "inline-flex" as const,
                  alignItems: "center" as const,
                  gap: 8,
                  padding: "6px 10px",
                  borderRadius: 999,
                  background: `${primaryColor}14`,
                  color: primaryColor,
                  fontWeight: 800,
                  whiteSpace: "nowrap",
                }}
                aria-label="porcentaje de avance del curso"
              >
                {pct}%
              </motion.span>

              <div
                aria-hidden
                style={{
                  flex: 1,
                  height: 10,
                  background: "rgba(0,0,0,0.08)",
                  borderRadius: 999,
                  overflow: "hidden" as const,
                }}
              >
                <div
                  style={{
                    width: `${pct}%`,
                    height: "100%",
                    background: primaryColor,
                    borderRadius: 999,
                    transition: "width 220ms ease",
                  }}
                />
              </div>
            </div>
          </div>
        </div>

        {/* Header */}
        <header style={{ ...container, paddingTop: 6, paddingBottom: 8 }}>
          <motion.div variants={containerVar} initial="hidden" animate="show">
            <motion.div variants={itemVar} style={{ marginBottom: 18 }}>
              <h1 style={{ margin: 0, fontSize: fs * 2.3, lineHeight: 1.15 }}>{title}</h1>
              <p style={{ margin: "8px 0 0", opacity: 0.9, fontSize: fs * 1.15 }}>
                <span style={{ color: primaryColor, fontWeight: 700 }}>▌</span> {topicTitle}
              </p>
            </motion.div>
          </motion.div>
        </header>

        {/* Contenido */}
        <section>
          <div style={{ ...container }}>
            <motion.div variants={containerVar} initial="hidden" animate="show">
              {/* Video (opcional) */}
              <motion.div variants={itemVar} style={{ marginBottom: 24 }}>
                <Card glow={primaryColor}>
                  {videoSrc ? (
                    <video
                      src={videoSrc}
                      poster={videoPoster || undefined}
                      controls
                      playsInline
                      style={{
                        width: "100%",
                        height: "auto",
                        display: "block" as const,
                        borderRadius: 12,
                        outline: "none",
                      }}
                    />
                  ) : (
                    <div
                      style={{
                        width: "100%",
                        display: "flex" as const,
                        alignItems: "center" as const,
                        justifyContent: "center" as const,
                        borderRadius: 12,
                        border: "2px dashed rgba(0,0,0,0.12)",
                        background: "#fff",
                        padding: 16,
                        textAlign: "center",
                      }}
                    >
                      <div>
                        <div
                          style={{
                            fontWeight: 800,
                            marginBottom: 6,
                            color: primaryColor,
                            fontSize: fs * 1.05,
                          }}
                        >
                          Espacio para tu video
                        </div>
                        <div style={{ opacity: 0.7 }}>
                          Sube tu archivo en tu UI (prop <b>videoSrc</b>).
                        </div>
                      </div>
                    </div>
                  )}
                </Card>
              </motion.div>

              {/* Quiz Opción múltiple */}
              <motion.div variants={itemVar}>
                <Card glow={primaryColor}>
                  {/* Progreso del quiz (interno) */}
                  <div
                    style={{
                      display: "flex" as const,
                      alignItems: "center" as const,
                      justifyContent: "space-between" as const,
                      marginBottom: 14,
                    }}
                  >
                    <strong style={{ fontSize: fs * 1.1 }}>
                      Pregunta {idx + 1} / {total}
                    </strong>
                    <div style={{ display: "flex" as const, alignItems: "center" as const, gap: 10 }}>
                      <div
                        style={{
                          width: 220,
                          height: 12,
                          background: "rgba(0,0,0,0.08)",
                          borderRadius: 999,
                          overflow: "hidden" as const,
                        }}
                      >
                        <div
                          style={{
                            width: `${quizProgressPct}%`,
                            height: "100%",
                            background: primaryColor,
                            borderRadius: 999,
                            transition: "width 220ms ease",
                          }}
                        />
                      </div>
                      <span style={{ fontSize: fs * 0.95, opacity: 0.75 }}>
                        {quizProgressPct}%
                      </span>
                    </div>
                  </div>

                  {/* Enunciado */}
                  <p style={{ margin: "10px 0 18px", lineHeight: 1.55, fontSize: fs * 1.1 }}>
                    {q.text}
                  </p>

                  {/* Opciones A–D */}
                  <div
                    style={{
                      display: "grid" as const,
                      gridTemplateColumns: "repeat(auto-fit, minmax(260px, 1fr))",
                      gap: 14,
                      marginBottom: 16,
                    }}
                  >
                    {q.options.map((opt, i) => {
                      const active = selection[idx] === i
                      return (
                        <motion.div
                          key={i}
                          role="button"
                          onClick={() => handleOptionClick(i)}
                          style={optStyle(active)}
                          whileHover={{ scale: 0.9 }}
                          whileTap={{ scale: 0.9 }}
                          transition={{ type: "spring", stiffness: 320, damping: 22 }}
                        >
                          {opt}
                        </motion.div>
                      )
                    })}
                  </div>

                  {/* Feedback breve */}
                  <div style={{ marginBottom: 4 }}>{feedback}</div>

                  {/* Resultado final */}
                  {finished ? (
                    <div
                      style={{
                        marginTop: 18,
                        padding: 16,
                        border: `1px solid ${primaryColor}33`,
                        borderRadius: 12,
                        background: "#fff",
                        display: "flex" as const,
                        alignItems: "center" as const,
                        justifyContent: "space-between" as const,
                      }}
                    >
                      <strong>Resultado:</strong>
                      <span style={{ fontWeight: 800, color: primaryColor }}>
                        {score} / {total}
                      </span>
                    </div>
                  ) : null}
                </Card>
              </motion.div>
            </motion.div>
          </div>
        </section>
      </main>
    </div>
  )
}

/* ---------- Preguntas (opción múltiple) para página 4 ---------- */
type MCQ = { text: string; options: string[]; correctIndex: number }

const QUESTIONS_PAGE4: MCQ[] = [
  { text: "En los primeros 3s debe...", options: ["Un efecto", "Captar la atención", "Explicar todo", "Poner subtítulos"], correctIndex: 1 },
  { text: "Un video viral se caracteriza por...", options: ["Muchos efectos", "Ser muy largo", "Que la gente quiera compartirlo", "Verse una sola vez"], correctIndex: 2 },
  { text: "Un gancho es...", options: ["Un filtro", "Frase/imagen que atrapa", "Un efecto complejo", "Una transición"], correctIndex: 1 },
  { text: "Mensaje sencillo porque...", options: ["Ahorrar edición", "Se entiende rápido", "Permite más efectos", "Alarga grabación"], correctIndex: 1 },
  { text: "Emociones que más impulsan interacción...", options: ["Indiferencia", "Confusión", "Alegría o sorpresa", "Molestia"], correctIndex: 2 },
  { text: "Aprovechar tendencia sin copiar es...", options: ["Copiar exacto", "Adaptarla con tu estilo", "Ignorar", "Hacerla muy larga"], correctIndex: 1 },
  { text: "Retos/challenges ayudan a...", options: ["Aburrir", "Crear comunidad y viralidad", "Evitar compartir", "Alargar"], correctIndex: 1 },
  { text: "Sin inicio llamativo, lo más probable es...", options: ["Más retención", "Abandono rápido", "Viral automático", "Más claridad"], correctIndex: 1 },
  { text: "La gente comparte cuando...", options: ["Mensaje confuso", "Emoción/valor inmediato", "Video muy largo", "Subtítulos exagerados"], correctIndex: 1 },
  { text: "Un error que arruina potencial es...", options: ["Mensaje claro", "Inicio enérgico", "Ser aburrido o confuso", "Usar tendencias"], correctIndex: 2 },
  { text: "CTA significa...", options: ["Tipo de edición", "Invitación a actuar", "Filtro", "Reto"], correctIndex: 1 },
  { text: "Para detectar tendencias conviene...", options: ["Ignorar lo popular", "Observar contenido viral", "Crear sin plan", "Usar contenido viejo"], correctIndex: 1 },
  { text: "Suele atraer más en redes...", options: ["Largo y complejo", "Breve y directo", "Sin emoción", "Sin historia"], correctIndex: 1 },
  { text: "Para diferenciarte conviene...", options: ["Copiar a otros", "Ser original y auténtico", "Hacerlo muy largo", "Llenar de efectos"], correctIndex: 1 },
  { text: "La viralidad depende de...", options: ["Solo suerte", "Estrategia y creatividad", "Copiar tendencias", "Música popular"], correctIndex: 1 },
]

type BSMXSection3Props = {
  brandName?: string
  logoSrc?: string
  primaryColor?: string
  background?: string
  progressPercent?: number
  title?: string
  topicTitle?: string
  layoutOption?: "A" | "B"
  baseFontSize?: number
  /** ms para mostrar feedback antes de pasar a la siguiente */
  autoAdvanceDelayMs?: number
}

function BSMXSection3({
  brandName = "BIZEN",
  logoSrc = "/bizen-mondragonlogo.png",
  primaryColor = "#0F62FE",
  background = "linear-gradient(180deg, #FFFFFF, #F8FAFF)",
  progressPercent = 10,
  title = "Sección 3",
  topicTitle = "Viralidad, ganchos y compartir (15 preguntas)",
  layoutOption = "B",
  baseFontSize = 18,
  autoAdvanceDelayMs = 650,
}: BSMXSection3Props) {
  const fs = Math.max(12, baseFontSize || 18)
  const isA = layoutOption === "A"

  const wrapper = useMemo(
    () => ({
      width: "100%",
      display: "flex" as const,
      justifyContent: isA ? "flex-start" : "center",
      background,
      color: "#111",
      fontFamily:
        "Montserrat, Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji",
      fontSize: fs,
      minHeight: "100vh",
      flexDirection: "column" as const,
    }),
    [background, isA, fs]
  )

  const container = useMemo(
    () => ({
      width: "100%",
      padding: "clamp(16px, 3vw, 32px)",
      boxSizing: "border-box" as const,
      margin: isA ? "0" : "0 auto",
    }),
    [isA]
  )

  const pct = Math.max(0, Math.min(100, Math.round(progressPercent)))

  const total = QUESTIONS_PAGE4.length
  const [idx, setIdx] = React.useState(0)
  const [selection, setSelection] = React.useState<(number | null)[]>(
    Array(total).fill(null)
  )
  const [checked, setChecked] = React.useState<boolean[]>(Array(total).fill(false))
  const [correct, setCorrect] = React.useState<boolean[]>(Array(total).fill(false))
  const [score, setScore] = React.useState(0)

  const q = QUESTIONS_PAGE4[idx]
  const quizProgressPct = Math.round(((idx + 1) / total) * 100)
  const answeredCount = checked.filter(Boolean).length
  const finished = answeredCount === total

  const optStyle = (active: boolean): React.CSSProperties => ({
    padding: "14px 16px",
    borderRadius: 12,
    border: `2px solid ${active ? primaryColor : "rgba(0,0,0,0.12)"}`,
    background: active ? `${primaryColor}10` : "#fff",
    fontWeight: 700,
    fontSize: fs * 1.0,
    letterSpacing: 0.2,
    cursor: "pointer",
    userSelect: "none",
    textAlign: "left",
    boxShadow: active ? "0 8px 24px rgba(0,0,0,0.06)" : "none",
    transformOrigin: "center",
  })

  // Clic = seleccionar, validar y avanzar automáticamente
  const handleSelect = (optionIndex: number) => {
    if (checked[idx]) return

    setSelection((prev) => {
      const next = [...prev]
      next[idx] = optionIndex
      return next
    })

    const isCorrect = optionIndex === q.correctIndex
    setChecked((prev) => {
      const n = [...prev]
      n[idx] = true
      return n
    })
    setCorrect((prev) => {
      const n = [...prev]
      n[idx] = isCorrect
      return n
    })
    if (isCorrect) setScore((s) => s + 1)

    // Muestra feedback breve y pasa a la siguiente (si existe)
    if (idx < total - 1) {
      setTimeout(() => setIdx((i) => (i < total - 1 ? i + 1 : i)), autoAdvanceDelayMs)
    }
  }

  const feedback =
    checked[idx] && correct[idx] ? (
      <div style={{ color: "#0a7f35", fontWeight: 700 }}>✅ ¡Correcto!</div>
    ) : checked[idx] && !correct[idx] ? (
      <div style={{ color: "#b00020", fontWeight: 700 }}>
        ❌ Incorrecto. Respuesta: <strong>{q.options[q.correctIndex]}</strong>
      </div>
    ) : null

  return (
    <div style={wrapper}>
      <main style={{ width: "100%", display: "block" }}>
        {/* Header */}
        <header style={{ ...container, paddingTop: 12, paddingBottom: 8 }}>
          <div style={{ display: "flex" as const, alignItems: "center" as const, gap: 12 }}>
            {logoSrc ? (
              <img src={logoSrc} alt={`${brandName} logo`} style={{ height: 62, width: "auto", display: "block" }} />
            ) : (
              <div aria-hidden style={{ width: 28, height: 28, borderRadius: 8, background: primaryColor }} />
            )}
            <strong style={{ letterSpacing: 0.2, fontWeight: 800, color: primaryColor, fontSize: fs * 1.35 }}>{brandName}</strong>
          </div>
        </header>

        {/* Barra de progreso general – % a la izquierda (breathing) */}
        <div style={{ ...container, paddingTop: 0 }}>
          <div style={{ display: "flex" as const, alignItems: "center" as const, gap: 12, marginBottom: 14 }}>
            <motion.span
              initial={{ scale: 1 }}
              animate={{ scale: [1, 1.15, 1] }}
              transition={{ duration: 1.2, repeat: Infinity, ease: "easeInOut" }}
              style={{
                display: "inline-flex" as const,
                alignItems: "center" as const,
                gap: 8,
                padding: "8px 12px",
                borderRadius: 999,
                background: `${primaryColor}14`,
                color: primaryColor,
                fontWeight: 700,
                fontSize: fs * 0.95,
                whiteSpace: "nowrap",
              }}
              aria-label="porcentaje de avance del curso"
            >
              {pct}%
            </motion.span>
            <div style={{ flex: 1, height: 10, background: "rgba(0,0,0,0.08)", borderRadius: 999, overflow: "hidden" }}>
              <motion.div
                initial={{ scaleY: 1 }}
                animate={{ scaleY: [1, 1.08, 1] }}
                transition={{ duration: 1.2, repeat: Infinity, ease: "easeInOut" }}
                style={{ width: `${pct}%`, height: "100%", background: primaryColor, borderRadius: 999, transformOrigin: "center" }}
              />
            </div>
          </div>
        </div>

        {/* Contenido */}
        <section>
          <div style={{ ...container }}>
            <motion.div variants={containerVar} initial="hidden" animate="show">
              {/* Título + Tema */}
              <motion.div variants={itemVar} style={{ marginBottom: 18 }}>
                <h1 style={{ margin: 0, fontSize: fs * 2.1, lineHeight: 1.15 }}>{title}</h1>
                <p style={{ margin: "8px 0 0", opacity: 0.9, fontSize: fs * 1.1, whiteSpace: "pre-wrap" }}>
                  <span style={{ color: primaryColor, fontWeight: 700 }}>▌</span> {topicTitle}
                </p>
              </motion.div>

              {/* Quiz */}
              <motion.div variants={itemVar}>
                <Card glow={primaryColor}>
                  {/* Progreso del quiz */}
                  <div
                    style={{
                      display: "flex" as const,
                      alignItems: "center" as const,
                      justifyContent: "space-between" as const,
                      marginBottom: 14,
                    }}
                  >
                    <strong style={{ fontSize: fs * 1.05 }}>
                      Pregunta {Math.min(idx + 1, total)} / {total}
                    </strong>
                    <div style={{ display: "flex" as const, alignItems: "center" as const, gap: 10 }}>
                      <div
                        style={{
                          width: 240,
                          height: 12,
                          background: "rgba(0,0,0,0.08)",
                          borderRadius: 999,
                          overflow: "hidden" as const,
                        }}
                      >
                        <div
                          style={{
                            width: `${Math.round(((idx + 1) / total) * 100)}%`,
                            height: "100%",
                            background: primaryColor,
                            borderRadius: 999,
                            transition: "width 220ms ease",
                          }}
                        />
                      </div>
                      <span style={{ fontSize: fs * 0.95, opacity: 0.75 }}>
                        {Math.round(((idx + 1) / total) * 100)}%
                      </span>
                    </div>
                  </div>

                  {/* Enunciado */}
                  <p style={{ margin: "10px 0 16px", lineHeight: 1.55, fontSize: fs * 1.1 }}>{q.text}</p>

                  {/* Opciones (clic = validar + auto-advance) */}
                  <div
                    style={{
                      display: "grid" as const,
                      gridTemplateColumns: "repeat(auto-fit, minmax(260px, 1fr))",
                      gap: 12,
                      marginBottom: 14,
                    }}
                  >
                    {q.options.map((opt, i) => {
                      const active = selection[idx] === i
                      const disabled = !!checked[idx]
                      return (
                        <motion.div
                          key={i}
                          role="button"
                          onClick={() => handleSelect(i)}
                          style={optStyle(active)}
                          aria-pressed={active}
                          whileHover={disabled ? undefined : { scale: 0.98 }}
                          whileTap={disabled ? undefined : { scale: 0.9 }}
                          transition={{ type: "spring", stiffness: 320, damping: 22 }}
                        >
                          {opt}
                        </motion.div>
                      )
                    })}
                  </div>

                  {/* Feedback breve antes de avanzar */}
                  <div style={{ minHeight: 28, marginBottom: 6 }}>{feedback}</div>

                  {/* Resultado final */}
                  {finished ? (
                    <div
                      style={{
                        marginTop: 12,
                        padding: 16,
                        border: `1px solid ${primaryColor}33`,
                        borderRadius: 12,
                        background: "#fff",
                        display: "flex" as const,
                        alignItems: "center" as const,
                        justifyContent: "space-between" as const,
                      }}
                    >
                      <strong>Resultado:</strong>
                      <span style={{ fontWeight: 800, color: primaryColor }}>
                        {score} / {total}
                      </span>
                    </div>
                  ) : null}
                </Card>
              </motion.div>
            </motion.div>
          </div>
        </section>
      </main>
    </div>
  )
}

/* ---------- UI helpers para Flashcards ---------- */

function GridFlashcards({ children, gap = 16, columns = 1 }: { children: React.ReactNode; gap?: number; columns?: number }) {
  return (
    <div
      style={{
        display: "grid" as const,
        gridTemplateColumns: `repeat(${columns}, 1fr)`,
        gap,
        alignItems: "stretch" as const,
        width: "100%",
      }}
    >
      {children}
    </div>
  )
}

function Flashcard({ front, back, primaryColor, fontSize }: { front: string; back: string; primaryColor: string; fontSize: number }) {
  const [open, setOpen] = React.useState(false)
  return (
    <motion.div
      role="button"
      onClick={() => setOpen(v => !v)}
      whileHover={{ scale: 0.9 }}
      whileTap={{ scale: 0.9 }}
      transition={{ type: "spring", stiffness: 280, damping: 20 }}
      style={{
        userSelect: "none",
        cursor: "pointer",
        borderRadius: 16,
        border: `1px solid ${primaryColor}33`,
        background: open ? `${primaryColor}0F` : "#fff",
        padding: 18,
        minHeight: 200,
        boxShadow: "0 10px 28px rgba(0,0,0,0.06)",
        display: "flex" as const,
        flexDirection: "column" as const,
        gap: 12,
        transformOrigin: "center",
        willChange: "transform",
      }}
    >
      <strong
        style={{
          color: primaryColor,
          display: "block" as const,
          fontSize: fontSize * 1.1,
          lineHeight: 1.2,
        }}
      >
        {front}
      </strong>

      <p
        style={{
          margin: 0,
          opacity: 0.95,
          fontSize: fontSize,
          lineHeight: 1.55,
          flex: 1,
        }}
      >
        {open ? back : "Toca para ver"}
      </p>
    </motion.div>
  )
}

/* ---------- Defaults para actividades ---------- */

const DEFAULT_INSTRUCTIONS = [
  "Guion rápido: redacta un guion de 15 segundos con inicio llamativo, mensaje claro y final sorpresivo.",
  "Frases gancho: escribe tres frases de apertura para captar atención inmediata.",
  "Análisis de tendencia: describe los elementos que hicieron popular un reel reciente que viste.",
]

type BSMXSection1Props = {
  brandName?: string
  logoSrc?: string
  primaryColor?: string
  background?: string
  progressPercent?: number
  title?: string
  topicTitle?: string
  layoutOption?: "A" | "B"
  baseFontSize?: number
  instructions?: string[]
  gridColumns?: number
  gridGap?: number
}

function BSMXSection1({
  brandName = "BIZEN",
  logoSrc = "/bizen-mondragonlogo.png",
  primaryColor = "#0F62FE",
  background = "linear-gradient(180deg, #FFFFFF, #F8FAFF)",
  progressPercent = 90,
  title = "Sección 3",
  topicTitle = "Actividades (para libreta) – 7 a 9",
  layoutOption = "B",
  baseFontSize = 18,
  instructions = DEFAULT_INSTRUCTIONS,
  gridColumns = 1,
  gridGap = 16,
}: BSMXSection1Props) {
  const fs = Math.max(12, baseFontSize || 18)
  const isLeft = layoutOption === "A"
  const pct = Math.max(0, Math.min(100, Math.round(progressPercent)))

  const list = (instructions?.length ? instructions : DEFAULT_INSTRUCTIONS).map((t, i) => ({
    front: `Actividad ${i + 7}`,
    back: t,
  }))

  const wrapper = useMemo(
    () => ({
      width: "100%",
      display: "flex" as const,
      justifyContent: isLeft ? "flex-start" : "center",
      background,
      color: "#111",
      fontFamily:
        "Montserrat, Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji",
      fontSize: fs,
    }),
    [background, isLeft, fs]
  )

  const container = useMemo(
    () => ({
      width: "100%",
      padding: "clamp(16px, 3vw, 32px)",
      boxSizing: "border-box" as const,
      margin: isLeft ? "0" : "0 auto",
    }),
    [isLeft]
  )

  return (
    <div style={wrapper}>
      <main style={{ width: "100%", display: "block" }}>
        {/* Header */}
        <header style={{ ...container, paddingTop: 12, paddingBottom: 8 }}>
          <div style={{ display: "flex" as const, alignItems: "center" as const, gap: 12 }}>
            {logoSrc ? (
              <img src={logoSrc} alt={`${brandName} logo`} style={{ height: 62, width: "auto", display: "block" }} />
            ) : (
              <div aria-hidden style={{ width: 28, height: 28, borderRadius: 8, background: primaryColor }} />
            )}
            <strong style={{ letterSpacing: 0.2, fontWeight: 800, color: primaryColor, fontSize: fs * 1.35 }}>{brandName}</strong>
          </div>
        </header>

        {/* Progreso (porcentaje con breathing a la izquierda) */}
        <div style={{ ...container, paddingTop: 0 }}>
          <div style={{ display: "flex" as const, alignItems: "center" as const, gap: 12, marginBottom: 14 }}>
            <motion.span
              initial={{ scale: 1 }}
              animate={{ scale: [1, 1.15, 1] }}
              transition={{ duration: 1.2, repeat: Infinity, ease: "easeInOut" }}
              style={{
                display: "inline-flex" as const,
                alignItems: "center" as const,
                gap: 8,
                padding: "8px 12px",
                borderRadius: 999,
                background: `${primaryColor}14`,
                color: primaryColor,
                fontWeight: 700,
                fontSize: fs * 0.95,
              }}
              aria-label="porcentaje de avance"
            >
              {pct}%
            </motion.span>
            <div
              style={{
                flex: 1,
                height: 10,
                background: "rgba(0,0,0,0.08)",
                borderRadius: 999,
                overflow: "hidden" as const,
              }}
            >
              <motion.div
                initial={{ scaleY: 1 }}
                animate={{ scaleY: [1, 1.06, 1] }}
                transition={{ duration: 1.2, repeat: Infinity, ease: "easeInOut" }}
                style={{
                  width: `${pct}%`,
                  height: "100%",
                  background: primaryColor,
                  borderRadius: 999,
                  transformOrigin: "center",
                }}
              />
            </div>
          </div>
        </div>

        {/* Contenido */}
        <section>
          <div style={{ ...container }}>
            <motion.div variants={containerVar} initial="hidden" animate="show">
              {/* Título + Tema */}
              <motion.div variants={itemVar} style={{ marginBottom: 14 }}>
                <h1 style={{ margin: 0, fontSize: fs * 2.3, lineHeight: 1.15 }}>{title}</h1>
                <p style={{ margin: "8px 0 0", opacity: 0.9, fontSize: fs * 1.15 }}>
                  <span style={{ color: primaryColor, fontWeight: 700 }}>▌</span> {topicTitle}
                </p>
              </motion.div>

              {/* Aviso motivacional */}
              <motion.div variants={itemVar} style={{ marginBottom: 18 }}>
                <Card glow={primaryColor}>
                  <div
                    style={{
                      display: "flex" as const,
                      alignItems: "center" as const,
                      gap: 10,
                      fontWeight: 800,
                      color: primaryColor,
                      fontSize: fs * 1.05,
                    }}
                  >
                    ✍️ Realiza las tres tareas centradas en gancho, claridad y análisis de tendencias.
                  </div>
                </Card>
              </motion.div>

              {/* Flashcards */}
              <motion.div variants={itemVar} style={{ marginBottom: 16 }}>
                <Card glow={primaryColor}>
                  <h3 style={{ margin: "0 0 12px 0", fontSize: fs * 1.3 }}>Actividades (para libreta) 7–9</h3>
                  <p style={{ margin: "0 0 16px 0", opacity: 0.8 }}>
                    Toca cada tarjeta para ver la instrucción y escribe tus respuestas en tu libreta.
                  </p>

                  <GridFlashcards gap={gridGap} columns={gridColumns}>
                    {list.map((c, i) => (
                      <Flashcard key={i} front={c.front} back={c.back} primaryColor={primaryColor} fontSize={fs} />
                    ))}
                  </GridFlashcards>
                </Card>
              </motion.div>
            </motion.div>
          </div>
        </section>
      </main>
    </div>
  )
}

const M4S3_CONTENT: Record<number, React.ReactNode> = {
  1: <Page1 />,
  2: <Page2 />,
  3: <SectionMC />,
  4: <BSMXSection3 />,
  5: <BSMXSection1 />,
}

export default M4S3_CONTENT
